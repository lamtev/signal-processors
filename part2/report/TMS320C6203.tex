\include{settings}

\begin{document}

\include{titlepage}

\newpage

\section{Алгоритм компенсации движения}

Компенсация движения -- это алгоритмический метод, используемый для прогнозирования кадра в видео на основе данных о предыдущих и/или будущих кадрах путём учёта движения камеры и/или объектов в видеопотоке. Данный алгоритм используется при кодировании видеоданных для сжатия видео, например, в стандарте MPEG-4. Компенсация движения характеризует изображение в терминах преобразования опорного кадра в текущий кадр. Опорный кадр может идти раньше, чем текущий, а может быть и после него. Для видеопотока, в котором последующие кадры могут быть синтезированы на основе ранее переданных, эффективность сжатия может быть улучшена.

\section{Особенности TMS320C6203}

\verb+TMS320C6203+ -- сигнальный процессор с фиксированной точкой, который благодаря архитектуре VelociTI$^{TM}$ обладает очень высокой производительностью и очень длинным словом инструкции (very-long-instruction-word
, VLIW). Благодаря большому параллелизму, на данном процессоре можно эффективно реализовать билинейную интерполяцию, которая используется в алгоритме компенсации движения. Поэтому для решения данной задачи \verb+TMS320C6203+ отлично подходит.

\section{Реализация алгоритма на ассемблере}

В рассматриваемой реализации компенсации движения цветовая модель пикселей -- цветоразностная YUV. Кадр разделяется на макроблоки. Макроблок состоит из 2-х блоков 8 $\times$ 8 пикселей, один из которых для U компоненты, другой для V компоненты, и 4-х блоков 8 $\times$ 8 для Y компоненты. Для простоты кадр разбивается на  8 $\times$ 8 макроблоков.

Реализация алгоритма выглядит следующим образом:

На вход алгоритма передаются:

\begin{itemize}
	\item Указатель на макроблок опорного кадра (\verb+ref_frame+)
	\item Указатель на макроблок текущего кадра (\verb+curr_frame+)
	\item Координаты левого верхнего угла текущего кадра (\verb+position+)
	\item Вектор движения (\verb+motion_vector+)
\end{itemize}

Далее, на основе \verb+motion_vector+ определяется какой способ интерполяции стоит использовать: копирование блока пикселей из опорного кадра в текущий, билинейную интерполяцию в горизонтальном направлении, билинейную интерполяцую в вертикальном направлении или билинейную интерполяцию в обоих направлениях.

Затем \verb+ref_frame+, \verb+curr_frame+, \verb+position+, \verb+motion_vector+ передаются в выбранный алгоритм интерполяции. После интерполяции получаем на выходе \verb+curr_frame+.

В листингах \ref{code:1} -- \ref{code:4} представлен исходный код на ассемблере процессора \verb+TMS320C6203+ для каждого способа интерполяции. 

\lstinputlisting[caption=Копирование блока пикселей, label=code:1]{case_a.asm}
\lstinputlisting[caption=Построчная билинейная интерполяция, label=code:2]{case_b.asm}
\lstinputlisting[caption=Постолбцовая билинейная интерполяция, label=code:3]{case_c.asm}
\lstinputlisting[caption=Билинейная интерполяция в обоих направлениях, label=code:4]{case_d.asm}

\end{document}